<%= render 'shared/nav'%>

<h1>Application ID: <%= params[:cas_id] %></h1>

<%= @result = SearchService.search(query: "*application_cas_id=#{params[:cas_id]}", field: nil, token: session[:jwt_token])[0] %>

<div class="search-results">
    <table>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Email</th>
      <th>Degree</th>
    </tr>
    <tr>
        <td><%= @result["application_cas_id"] %></td>
        <td><%= @result["application_name"] %></td>
        <td><%= @result["application_email"] %></td>
        <td><a href="/application?cas_id=<%= @result["application_cas_id"] %>"><%= @result["application_degree"]  %></a></td> 
    </tr>
  </table>
  </div>
<div>
    <h2>Add a new Application Review</h2>
    <%= render 'application/review_form'%>
</div>
<div>
    <h2>Other Application Reviews</h2>
    <% others = Review.where(applicant_id: @result["application_cas_id"], status: "completed").where.not(user_netid: current_user.user_netid) %>
    <div class="search-results">
      <table>
        <tr>
          <th> Rating </th>
          <th> Reviewed By </th>
        </tr>
        <% others.each do |other| %>
        <tr>
          <td><%= other.rating %></td>
          <td><%= link_to other.user_netid, review_path(other) %></td>
        </tr>
        <%end%>
      </table>
    </div>
</div>
