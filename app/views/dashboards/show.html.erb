
<div class="container" style="margin-top: 100px;">
    <!-- Rule Selection -->
    <div class="mb-3">
    <input type="checkbox" id="roundRobin" name="roundRobin">
    <label for="roundRobin">Round Robin Approach</label><br>
    <input type="checkbox" id="minThree" name="minThree">
    <label for="minThree">3 Users per Application</label><br>
    </div>

    <!-- Assign Button -->
    <div class="assign-button">
    <button id="assignButton" class="btn btn-primary btn-block " style="margin: 0;" onclick="assignReviewers()">Assign</button>
    </div>
    <!-- Alert for Assignment Status -->
    <div id="assignmentAlert" class="alert" style="display: none;"></div>
    <h2 class="mt-4">Committee Members</h2>
    <hr> <!-- Division line -->
    <!-- User Cards Container -->
    <div class="row mt-4">
        <% @committee_members.each_slice(2) do |pair| %>
            <div class="row">
            <% pair.each do |member| %>
                <div class="col-md-6">
                <div class="dashboard card" style="margin-bottom: 10px">
                    <div class="card-body">
                    <h5 class="card-title"><%= member.user_name %></h5>
                    <hr> <!-- Division line -->
                   <table class="table">
                        <!-- Table Header -->
                        <thead>
                            <tr>
                            <th scope="col">Name</th>
                            <th scope="col">CAS ID</th>
                            <th scope="col">Actions</th>
                            </tr>
                        </thead>
                    </table>
                        <div style="overflow-y:auto; max-height: 300px;">
                            <table class="table">
                            
                                    <tbody id="applicationList">
                                        <% @committee_reviews[member.user_netid].each do |review| %>
                                        <tr>
                                            <td class="clickable-row" data-href="/applicant?cas_id=<%= review.applicant_id %>"><%= @applicant_names[review.applicant_id] %></td>
                                            <td><%= review.applicant_id %></td>
                                            <td><button type="button" class="btn btn-primary btn-sm">remove</button></td>
                                        </tr>
                                        <% end %>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                </div>
            <% end %>
            </div>
        <% end %>
    </div>
</div>


  <script>
    function assignReviewers(){
        var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        var checkboxesChecked = [];
        for (var i = 0; i < checkboxes.length; i++) {
            // Push the checked checkboxes onto an array
            checkboxesChecked.push(checkboxes[i].id);
        }
        console.log(checkboxesChecked);

        url =   "<%= @phd_app_url%>" + "/randomassign";
        fetch(url, {
        method: 'POST', // Specify the method as POST
        headers: {
            'Content-Type': 'application/json', // Set the content type header so that the server knows the format of the sent data
        },
        body: JSON.stringify({"option": checkboxesChecked}) // Convert the JavaScript object to a JSON string and send it as the request body
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json(); // Parse the JSON response
        })
        .then(data => {
            console.log('Success:', data); // Handle the response data
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error); // Handle any errors
        });
    }
    document.addEventListener('DOMContentLoaded', function() {
    var rows = document.querySelectorAll('.clickable-row');
    rows.forEach(function(row) {
      row.addEventListener('click', function() {
        window.location.href = this.dataset.href;
      });
    });
  });
  </script>